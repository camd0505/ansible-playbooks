# Rebooting Production Linux Servers
---
- hosts: vsu-web-001,vsu-apl-009,vsu-apl-002,vsu-apl-003,dmz-vsu-atm-001,dmz-vsu-apl-001,dmz-vsu-apl-002,dmz-vsu-apl-003,dmz-vsu-apl-005
  gather_facts: true
  become: true

  tasks:
    - name: Restarting Production servers
      shell: sleep 10 && /sbin/shutdown -r now 
      async: 300
      poll: 0
      become: true
      
    - name: waiting 30 secs for server to come back
      local_action: wait_for host={{ ansible_default_ipv4.address }} port=22 state=started delay=30 timeout=180
      become: false
